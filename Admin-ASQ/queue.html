<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Queue Manager - Salon Admin</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <!-- Custom CSS -->
    <link rel="stylesheet" href="salon.css">
</head>
<body>
    <div class="container-fluid p-0">
        <div class="row g-0">
            <!-- Sidebar -->
            <div class="col-md-2 sidebar">
                <div class="sidebar-header text-center py-3">
                    <div class="admin-icon">
                        <i class="bi bi-person-circle fs-1 text-white"></i>
                    </div>
                    <h5 class="text-white mt-2">Admin</h5>
                </div>
                
                <div class="sidebar-menu">
                    <h6 class="menu-header">Main Menu</h6>
                    <ul class="nav flex-column">
                        <li class="nav-item">
                            <a class="nav-link" href="dashboard.html">
                                CUSTOMER APPOINTMENT CALENDAR
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="appointment.html">
                                CUSTOMER BOOKINGS
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link active" href="queue.html">
                                QUEUE MANAGER
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" href="services.html">
                                SERVICES MANAGER
                            </a>
                        </li>
                    </ul>
                    
                    <div class="logout-container">
                        <a href="index.html" class="btn btn-logout">LOG OUT</a>
                    </div>
                </div>
            </div>
            
            <!-- Main Content -->
            <div class="col-md-10 main-content">
                <div class="p-3 border-bottom d-flex justify-content-between align-items-center">
                    <div class="d-flex align-items-center">
                        <div class="admin-icon me-2">
                            <i class="bi bi-person-circle fs-3"></i>
                        </div>
                        <span class="fw-bold">Admin</span>
                    </div>
                    <div>
                        <a href="#" class="salon-profile-link">
                            <img src="logo.png" alt="Salon Profile" height="70px" width="70" class="rounded-circle"">
                        </a>
                    </div>
                </div>
                
                <div class="p-4">
                    <div class="d-flex justify-content-between align-items-center mb-4">
                        <h2>Queue Manager</h2>
                        <div>
                            <button class="btn btn-sm btn-outline-success me-2" id="add-queue-btn">
                                <i class="bi bi-plus-circle me-1"></i> Add to Queue
                            </button>
                            <button class="btn btn-sm btn-outline-pink" id="notify-all-btn">
                                <i class="bi bi-bell me-1"></i> Notify All
                            </button>
                        </div>
                    </div>
                    
                    <div class="alert alert-success d-none" id="queue-message"></div>
                    
                    <div class="row mb-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-pink text-white">
                                    <h5 class="mb-0">Today's Queue</h5>
                                </div>
                                <div class="card-body">
                                    <div class="current-serving p-3 mb-3 bg-light text-center">
                                        <h3 class="mb-0">Now Serving</h3>
                                        <div class="display-1 text-pink fw-bold" id="current-number">3</div>
                                        <p class="mb-0" id="current-customer">Jennie Kim</p>
                                    </div>
                                    
                                    <div class="d-flex justify-content-center mb-3">
                                        <button class="btn btn-outline-secondary me-2" id="prev-queue">
                                            <i class="bi bi-arrow-left"></i> Previous
                                        </button>
                                        <button class="btn btn-outline-pink" id="next-queue">
                                            Next <i class="bi bi-arrow-right"></i>
                                        </button>
                                    </div>
                                    
                                    <div class="queue-stats d-flex justify-content-around text-center">
                                        <div>
                                            <h5>Waiting</h5>
                                            <p class="mb-0 fs-4" id="waiting-count">2</p>
                                        </div>
                                        <div>
                                            <h5>Served</h5>
                                            <p class="mb-0 fs-4" id="served-count">2</p>
                                        </div>
                                        <div>
                                            <h5>Total</h5>
                                            <p class="mb-0 fs-4" id="total-count">5</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-header bg-pink text-white">
                                    <h5 class="mb-0">Queue List</h5>
                                </div>
                                <div class="card-body p-0">
                                    <div class="table-responsive">
                                        <table class="table mb-0">
                                            <thead>
                                                <tr>
                                                    <th>Queue #</th>
                                                    <th>Customer</th>
                                                    <th>Service</th>
                                                    <th>Status</th>
                                                    <th>Actions</th>
                                                </tr>
                                            </thead>
                                            <tbody id="queue-table">
                                                <!-- Queue will be loaded by JavaScript -->
                                            </tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header bg-pink text-white">
                            <h5 class="mb-0">Tomorrow's Queue</h5>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Queue #</th>
                                            <th>Customer</th>
                                            <th>Service</th>
                                            <th>Time</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tomorrow-queue">
                                        <!-- Tomorrow's queue will be loaded by JavaScript -->
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Add to Queue Modal -->
    <div class="modal fade" id="addQueueModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-pink text-white">
                    <h5 class="modal-title">Add to Queue</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="addQueueForm">
                        <div class="mb-3">
                            <label for="customerName" class="form-label">Customer Name</label>
                            <input type="text" class="form-control" id="customerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="customerPhone" class="form-label">Phone Number</label>
                            <input type="text" class="form-control" id="customerPhone" required>
                        </div>
                        <div class="mb-3">
                            <label for="serviceType" class="form-label">Service</label>
                            <select class="form-select" id="serviceType" required>
                                <option value="">Select a service</option>
                                <option value="Hair Cut & Style">Hair Cut & Style</option>
                                <option value="Hair Color">Hair Color</option>
                                <option value="Manicure & Pedicure">Manicure & Pedicure</option>
                                <option value="Facial Treatment">Facial Treatment</option>
                                <option value="Hot Oil Treatment">Hot Oil Treatment</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label for="queueDate" class="form-label">Date</label>
                            <select class="form-select" id="queueDate">
                                <option value="today">Today</option>
                                <option value="tomorrow">Tomorrow</option>
                            </select>
                        </div>
                        <div class="mb-3" id="timeField">
                            <label for="queueTime" class="form-label">Time (Tomorrow Only)</label>
                            <input type="time" class="form-control" id="queueTime">
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-pink" id="saveQueue">Add to Queue</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Notify Customer Modal -->
    <div class="modal fade" id="notifyModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-pink text-white">
                    <h5 class="modal-title">Notify Customer</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="notifyForm">
                        <input type="hidden" id="notifyQueueId">
                        <div class="mb-3">
                            <label for="notifyMessage" class="form-label">Message</label>
                            <textarea class="form-control" id="notifyMessage" rows="3" required></textarea>
                        </div>
                        <div class="form-check mb-3">
                            <input class="form-check-input" type="checkbox" id="sendSMS" checked>
                            <label class="form-check-label" for="sendSMS">
                                Send via SMS
                            </label>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-pink" id="sendNotification">Send Notification</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script src="js/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample queue data
            let queueData = {
                current: 3,
                served: 2,
                waiting: 2,
                total: 5,
                today: [
                    {
                        id: 1,
                        number: 1,
                        customer: 'Customer 1',
                        phone: '+639123456781',
                        service: 'Hair Cut & Style',
                        status: 'served'
                    },
                    {
                        id: 2,
                        number: 2,
                        customer: 'Customer 2',
                        phone: '+639123456782',
                        service: 'Manicure & Pedicure',
                        status: 'served'
                    },
                    {
                        id: 3,
                        number: 3,
                        customer: 'Jennie Kim',
                        phone: '+639123456789',
                        service: 'Hair Color',
                        status: 'serving'
                    },
                    {
                        id: 4,
                        number: 4,
                        customer: 'Customer 4',
                        phone: '+639123456784',
                        service: 'Facial Treatment',
                        status: 'waiting'
                    },
                    {
                        id: 5,
                        number: 5,
                        customer: 'Customer 5',
                        phone: '+639123456785',
                        service: 'Hot Oil Treatment',
                        status: 'waiting'
                    }
                ],
                tomorrow: [
                    {
                        id: 6,
                        number: 1,
                        customer: 'Customer 6',
                        phone: '+639123456786',
                        service: 'Hair Cut & Style',
                        time: '10:00'
                    },
                    {
                        id: 7,
                        number: 2,
                        customer: 'Customer 7',
                        phone: '+639123456787',
                        service: 'Hair Color',
                        time: '11:30'
                    },
                    {
                        id: 8,
                        number: 3,
                        customer: 'Customer 8',
                        phone: '+639123456788',
                        service: 'Manicure & Pedicure',
                        time: '14:00'
                    }
                ]
            };
            
            // Load queue data
            function loadQueueData() {
                // Update current serving
                document.getElementById('current-number').textContent = queueData.current;
                document.getElementById('current-customer').textContent = queueData.today.find(q => q.number === queueData.current)?.customer || '';
                
                // Update stats
                document.getElementById('waiting-count').textContent = queueData.waiting;
                document.getElementById('served-count').textContent = queueData.served;
                document.getElementById('total-count').textContent = queueData.total;
                
                // Load today's queue
                const queueTable = document.getElementById('queue-table');
                queueTable.innerHTML = '';
                
                queueData.today.forEach(queue => {
                    const row = document.createElement('tr');
                    
                    // Set row class based on status
                    if (queue.status === 'serving') {
                        row.className = 'table-primary';
                    } else if (queue.status === 'served') {
                        row.className = 'table-success';
                    }
                    
                    // Create status badge
                    let statusBadgeClass = 'bg-secondary';
                    if (queue.status === 'serving') statusBadgeClass = 'bg-primary';
                    if (queue.status === 'served') statusBadgeClass = 'bg-success';
                    
                    row.innerHTML = `
                        <td>${queue.number}</td>
                        <td>${queue.customer}</td>
                        <td>${queue.service}</td>
                        <td><span class="badge ${statusBadgeClass}">${queue.status}</span></td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1 notify-btn" data-queue-id="${queue.id}">
                                <i class="bi bi-bell"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger remove-btn" data-queue-id="${queue.id}">
                                <i class="bi bi-x-circle"></i>
                            </button>
                        </td>
                    `;
                    
                    queueTable.appendChild(row);
                });
                
                // Load tomorrow's queue
                const tomorrowQueue = document.getElementById('tomorrow-queue');
                tomorrowQueue.innerHTML = '';
                
                queueData.tomorrow.forEach(queue => {
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>${queue.number}</td>
                        <td>${queue.customer}</td>
                        <td>${queue.service}</td>
                        <td>${queue.time}</td>
                        <td>
                            <button class="btn btn-sm btn-outline-primary me-1 notify-btn" data-queue-id="${queue.id}">
                                <i class="bi bi-bell"></i>
                            </button>
                            <button class="btn btn-sm btn-outline-danger remove-btn" data-queue-id="${queue.id}">
                                <i class="bi bi-x-circle"></i>
                            </button>
                        </td>
                    `;
                    
                    tomorrowQueue.appendChild(row);
                });
                
                // Add event listeners
                document.querySelectorAll('.notify-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const queueId = this.getAttribute('data-queue-id');
                        openNotifyModal(queueId);
                    });
                });
                
                document.querySelectorAll('.remove-btn').forEach(button => {
                    button.addEventListener('click', function() {
                        const queueId = this.getAttribute('data-queue-id');
                        removeFromQueue(queueId);
                    });
                });
            }
            
            // Initial load
            loadQueueData();
            
            // Next queue button
            document.getElementById('next-queue').addEventListener('click', function() {
                const nextQueue = queueData.today.find(q => q.status === 'waiting');
                if (!nextQueue) {
                    showQueueMessage('No more customers in queue');
                    return;
                }
                
                // Update current queue
                const currentQueue = queueData.today.find(q => q.status === 'serving');
                if (currentQueue) {
                    currentQueue.status = 'served';
                    queueData.served++;
                    queueData.waiting--;
                }
                
                // Set next queue as current
                nextQueue.status = 'serving';
                queueData.current = nextQueue.number;
                
                // Reload queue data
                loadQueueData();
                
                // Show success message
                showQueueMessage(`Now serving: ${nextQueue.customer}`);
            });
            
            // Previous queue button
            document.getElementById('prev-queue').addEventListener('click', function() {
                const currentIndex = queueData.today.findIndex(q => q.status === 'serving');
                if (currentIndex <= 0 || !queueData.today[currentIndex - 1]) {
                    showQueueMessage('No previous customer in queue');
                    return;
                }
                
                // Update current queue
                const currentQueue = queueData.today[currentIndex];
                if (currentQueue) {
                    currentQueue.status = 'waiting';
                    queueData.served--;
                    queueData.waiting++;
                }
                
                // Set previous queue as current
                const prevQueue = queueData.today[currentIndex - 1];
                prevQueue.status = 'serving';
                queueData.current = prevQueue.number;
                
                // Reload queue data
                loadQueueData();
                
                // Show success message
                showQueueMessage(`Returned to: ${prevQueue.customer}`);
            });
            
            // Add to queue modal
            const addQueueModal = new bootstrap.Modal(document.getElementById('addQueueModal'));
            
            document.getElementById('add-queue-btn').addEventListener('click', function() {
                // Reset form
                document.getElementById('addQueueForm').reset();
                
                // Show/hide time field based on date selection
                toggleTimeField();
                
                // Show modal
                addQueueModal.show();
            });
            
            // Toggle time field based on date selection
            document.getElementById('queueDate').addEventListener('change', toggleTimeField);
            
            function toggleTimeField() {
                const queueDate = document.getElementById('queueDate').value;
                const timeField = document.getElementById('timeField');
                
                if (queueDate === 'tomorrow') {
                    timeField.style.display = 'block';
                    document.getElementById('queueTime').required = true;
                } else {
                    timeField.style.display = 'none';
                    document.getElementById('queueTime').required = false;
                }
            }
            
            // Save queue
            document.getElementById('saveQueue').addEventListener('click', function() {
                const customerName = document.getElementById('customerName').value;
                const customerPhone = document.getElementById('customerPhone').value;
                const serviceType = document.getElementById('serviceType').value;
                const queueDate = document.getElementById('queueDate').value;
                const queueTime = document.getElementById('queueTime').value;
                
                // Validate form
                if (!customerName || !customerPhone || !serviceType) {
                    alert('Please fill in all required fields');
                    return;
                }
                
                if (queueDate === 'tomorrow' && !queueTime) {
                    alert('Please select a time for tomorrow\'s appointment');
                    return;
                }
                
                // Add to queue
                if (queueDate === 'today') {
                    // Add to today's queue
                    const newQueue = {
                        id: queueData.today.length + 1,
                        number: queueData.total + 1,
                        customer: customerName,
                        phone: customerPhone,
                        service: serviceType,
                        status: 'waiting'
                    };
                    
                    queueData.today.push(newQueue);
                    queueData.total++;
                    queueData.waiting++;
                    
                    // Show success message
                    showQueueMessage(`${customerName} added to today's queue as #${newQueue.number}`);
                } else {
                    // Add to tomorrow's queue
                    const newQueue = {
                        id: queueData.tomorrow.length + 10,
                        number: queueData.tomorrow.length + 1,
                        customer: customerName,
                        phone: customerPhone,
                        service: serviceType,
                        time: queueTime
                    };
                    
                    queueData.tomorrow.push(newQueue);
                    
                    // Show success message
                    showQueueMessage(`${customerName} added to tomorrow's queue as #${newQueue.number}`);
                }
                
                // Close modal
                addQueueModal.hide();
                
                // Reload queue data
                loadQueueData();
            });
            
            // Remove from queue
            function removeFromQueue(queueId) {
                // Find queue in today's list
                let queueIndex = queueData.today.findIndex(q => q.id == queueId);
                let isTodayQueue = true;
                
                // If not found in today's list, check tomorrow's list
                if (queueIndex === -1) {
                    queueIndex = queueData.tomorrow.findIndex(q => q.id == queueId);
                    isTodayQueue = false;
                }
                
                // If not found in either list, return
                if (queueIndex === -1) return;
                
                // Get queue data
                const queue = isTodayQueue ? queueData.today[queueIndex] : queueData.tomorrow[queueIndex];
                
                // Confirm removal
                if (!confirm(`Are you sure you want to remove ${queue.customer} from the queue?`)) {
                    return;
                }
                
                // Remove from queue
                if (isTodayQueue) {
                    // Update stats if removing from today's queue
                    if (queue.status === 'waiting') {
                        queueData.waiting--;
                    } else if (queue.status === 'served') {
                        queueData.served--;
                    }
                    
                    queueData.total--;
                    queueData.today.splice(queueIndex, 1);
                } else {
                    queueData.tomorrow.splice(queueIndex, 1);
                    
                    // Renumber tomorrow's queue
                    queueData.tomorrow.forEach((q, i) => {
                        q.number = i + 1;
                    });
                }
                
                // Reload queue data
                loadQueueData();
                
                // Show success message
                showQueueMessage(`${queue.customer} removed from queue`);
            }
            
            // Notify customer modal
            const notifyModal = new bootstrap.Modal(document.getElementById('notifyModal'));
            
            function openNotifyModal(queueId) {
                // Find queue in today's list
                let queue = queueData.today.find(q => q.id == queueId);
                let isTodayQueue = true;
                
                // If not found in today's list, check tomorrow's list
                if (!queue) {
                    queue = queueData.tomorrow.find(q => q.id == queueId);
                    isTodayQueue = false;
                }
                
                // If not found in either list, return
                if (!queue) return;
                
                // Set queue ID
                document.getElementById('notifyQueueId').value = queueId;
                
                // Set default message
                let defaultMessage = '';
                if (isTodayQueue) {
                    if (queue.status === 'waiting') {
                        const currentNumber = queueData.current;
                        const queuePosition = queue.number - currentNumber;
                        defaultMessage = `Hi ${queue.customer}, you are #${queue.number} in the queue. There are ${queuePosition} customers ahead of you. Please be ready in approximately ${queuePosition * 30} minutes.`;
                    } else if (queue.status === 'serving') {
                        defaultMessage = `Hi ${queue.customer}, it's your turn now! Please proceed to the salon counter.`;
                    }
                } else {
                    defaultMessage = `Hi ${queue.customer}, this is a reminder of your appointment tomorrow at ${queue.time}. Please arrive 10 minutes early.`;
                }
                
                document.getElementById('notifyMessage').value = defaultMessage;
                
                // Show modal
                notifyModal.show();
            }
            
            // Send notification
            document.getElementById('sendNotification').addEventListener('click', function() {
                const queueId = document.getElementById('notifyQueueId').value;
                const message = document.getElementById('notifyMessage').value;
                const sendSMS = document.getElementById('sendSMS').checked;
                
                // Find queue in today's list
                let queue = queueData.today.find(q => q.id == queueId);
                
                // If not found in today's list, check tomorrow's list
                if (!queue) {
                    queue = queueData.tomorrow.find(q => q.id == queueId);
                }
                
                // If not found in either list, return
                if (!queue) return;
                
                // Validate message
                if (!message) {
                    alert('Please enter a message');
                    return;
                }
                
                // Close modal
                notifyModal.hide();
                
                // Show success message
                showQueueMessage(`Notification sent to ${queue.customer}${sendSMS ? ' via SMS' : ''}`);
            });
            
            // Notify all button
            document.getElementById('notify-all-btn').addEventListener('click', function() {
                // Get all waiting customers
                const waitingCustomers = queueData.today.filter(q => q.status === 'waiting');
                
                if (waitingCustomers.length === 0) {
                    showQueueMessage('No waiting customers to notify');
                    return;
                }
                
                // Confirm notification
                if (!confirm(`Are you sure you want to notify all ${waitingCustomers.length} waiting customers?`)) {
                    return;
                }
                
                // Show success message
                showQueueMessage(`Notifications sent to ${waitingCustomers.length} customers`);
            });
            
            // Show queue message
            function showQueueMessage(message) {
                const queueMessage = document.getElementById('queue-message');
                queueMessage.textContent = message;
                queueMessage.classList.remove('d-none');
                
                // Hide after 3 seconds
                setTimeout(() => {
                    queueMessage.classList.add('d-none');
                }, 3000);
            }
        });
    </script>
</body>
</html>